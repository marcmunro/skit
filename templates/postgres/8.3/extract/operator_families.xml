<?xml version="1.0" encoding="UTF-8"?>

<skit:inclusion
   xmlns:skit="http://www.bloodnok.com/xml/skit"
   xmlns:xi="http://www.w3.org/2003/XInclude">

  <skit:foreach var="operator_family" from="operator_families" 
		filter="(string= (select operator_family 'schema')
			         (select schema 'name'))">
    <operator_family>
      <skit:attr name="name"/>
      <skit:attr name="schema"/>
      <skit:attr name="owner"/>
      <skit:attr name="method"/>
      <skit:attr name="auto_generated"/>
      <skit:if test="(select operator_family 'comment')">
	<comment>
	  <skit:text expr="(select operator_family 'comment')"/>
	</comment>
      </skit:if>

      <skit:foreach var="opclass_oper" from="opclass_opers"
		    filter="(and (string= (select opclass_oper 'family_oid')
			                  (select operator_family 'oid'))
				 (not (select opclass_oper 'class_oid')))">
	<!-- This is pasted in from operator_classes.xml.  TODO:
	     Make this a template call -->
	<opclass_operator>
	  <skit:attr name="name"/>
	  <skit:attr name="schema"/>
	  <skit:attr name="strategy"/>
	  <skit:attr name="recheck"/>
	  <skit:if test="(select opclass_oper 'leftarg_type')">
	    <arg position="left">
	      <skit:attr name="name"
      			 expr="(select opclass_oper 'leftarg_type')"/>
	      <skit:attr name="schema"
      			 expr="(select opclass_oper 'leftarg_schema')"/>
	    </arg>	
	  </skit:if>
	  <skit:if test="(select opclass_oper 'rightarg_type')">
	    <arg position="right">
	      <skit:attr name="name"
      			 expr="(select opclass_oper 'rightarg_type')"/>
	      <skit:attr name="schema"
      			 expr="(select opclass_oper 'rightarg_schema')"/>
	    </arg>	
	  </skit:if>
	</opclass_operator>
      </skit:foreach>

      <skit:foreach var="opclass_func" from="opclass_funcs"
		    filter="(and (string= (select opclass_func 'family_oid')
			                  (select operator_family 'oid'))
				 (not (select opclass_func 'class_oid')))">
	<!-- This is pasted in from operator_classes.xml.  TODO:
	     Make this a template call -->
	<opclass_function>
	  <skit:attr name="name"/>
	  <skit:attr name="schema"/>
	  <skit:attr name="proc_num"/>
	  <params>
	    <param position="1">
	      <skit:attr name="type" 
			 expr="(select opclass_func 'left_type')"/>
	      <skit:attr name="schema" 
			 expr="(select opclass_func 'left_type_schema')"/>
	    </param>
	    <param position="2">
	      <skit:attr name="type" 
			 expr="(select opclass_func 'right_type')"/>
	      <skit:attr name="schema" 
			 expr="(select opclass_func 'right_type_schema')"/>
	    </param>
	  </params>
	</opclass_function>
      </skit:foreach>
    </operator_family>
  </skit:foreach>
</skit:inclusion>  

